# RemoteCWKeyerV3 - Configuration Parameters Schema V2
#
# Hierarchical family structure with dot-notation paths.
# Code generation script reads this file and generates:
#   - config.h (per-family atomic structs)
#   - config_console.h (family + parameter metadata)
#   - config_nvs.h (NVS persistence)
#
# DO NOT edit generated files manually - edit this schema instead.

version: 2

families:
  keyer:
    order: 1
    icon: "key"
    label:
      en: "Keyer"
      it: "Manipolatore"
    description:
      en: "Keying behavior and timing"
      it: "Comportamento e temporizzazione"
    aliases: [k]

    parameters:
      wpm:
        type: u16
        default: 25
        range: [5, 100]
        nvs_key: "wpm"
        runtime_change: idle_only
        priority: 1
        gui:
          label_short:
            en: "WPM"
            it: "PPM"
          label_long:
            en: "Words Per Minute"
            it: "Parole Per Minuto"
          description:
            en: "Keying speed in words per minute (PARIS standard)"
            it: "Velocità di manipolazione in parole per minuto (standard PARIS)"
          widget: slider
          widget_config:
            step: 1
            tick_interval: 5
          advanced: false

      iambic_mode:
        type: enum
        enum_values: [ModeA, ModeB]
        default: ModeA
        nvs_key: "mode"
        runtime_change: idle_only
        priority: 2
        gui:
          label_short:
            en: "Mode"
            it: "Modalità"
          label_long:
            en: "Iambic Mode"
            it: "Modalità Iambica"
          description:
            en: "Mode A: release priority, Mode B: last contact priority"
            it: "Modo A: priorità al rilascio, Modo B: priorità all'ultimo contatto"
          widget: dropdown
          widget_config:
            options:
              - value: ModeA
                label:
                  en: "Mode A (Release Priority)"
                  it: "Modo A (Priorità Rilascio)"
              - value: ModeB
                label:
                  en: "Mode B (Last Contact)"
                  it: "Modo B (Ultimo Contatto)"
          advanced: false

      memory_mode:
        type: enum
        enum_values: [NONE, DOT_ONLY, DAH_ONLY, DOT_AND_DAH]
        default: DOT_AND_DAH
        nvs_key: "mem_mode"
        runtime_change: idle_only
        priority: 3
        gui:
          label_short:
            en: "Memory"
            it: "Memoria"
          label_long:
            en: "Memory Mode"
            it: "Modalità Memoria"
          description:
            en: "Which paddles are remembered during element transmission"
            it: "Quali paddle sono memorizzati durante la trasmissione dell'elemento"
          widget: dropdown
          widget_config:
            options:
              - value: NONE
                label:
                  en: "No memory"
                  it: "Nessuna memoria"
              - value: DOT_ONLY
                label:
                  en: "Remember dot only"
                  it: "Solo memoria dot"
              - value: DAH_ONLY
                label:
                  en: "Remember dah only"
                  it: "Solo memoria dah"
              - value: DOT_AND_DAH
                label:
                  en: "Remember both (full iambic)"
                  it: "Memoria entrambi (iambic completo)"
          advanced: false

      squeeze_mode:
        type: enum
        enum_values: [LATCH_OFF, LATCH_ON]
        default: LATCH_OFF
        nvs_key: "sqz_mode"
        runtime_change: idle_only
        priority: 4
        gui:
          label_short:
            en: "Squeeze"
            it: "Squeeze"
          label_long:
            en: "Squeeze Timing"
            it: "Temporizzazione Squeeze"
          description:
            en: "When to sample paddle state (Live=continuous, Snapshot=latch at start)"
            it: "Quando campionare lo stato dei paddle (Live=continuo, Snapshot=latch all'inizio)"
          widget: dropdown
          widget_config:
            options:
              - value: LATCH_OFF
                label:
                  en: "Live (immediate)"
                  it: "Live (immediato)"
              - value: LATCH_ON
                label:
                  en: "Snapshot (latch)"
                  it: "Snapshot (latch)"
          advanced: true

      weight:
        type: u8
        default: 50
        range: [33, 67]
        nvs_key: "weight"
        runtime_change: idle_only
        priority: 5
        gui:
          label_short:
            en: "Weight"
            it: "Peso"
          label_long:
            en: "Dit/Dah Weight"
            it: "Peso Dit/Dah"
          description:
            en: "Timing weight (50 = 1:3 ratio, <50 lighter, >50 heavier)"
            it: "Peso temporizzazione (50 = rapporto 1:3, <50 più leggero, >50 più pesante)"
          widget: slider
          widget_config:
            step: 1
            tick_interval: 5
            center_mark: 50
          advanced: false

      mem_window_start_pct:
        type: u8
        default: 0
        range: [0, 100]
        nvs_key: "mem_start"
        runtime_change: idle_only
        priority: 11
        gui:
          label_short:
            en: "Mem Start"
            it: "Inizio Mem"
          label_long:
            en: "Memory Window Start (%)"
            it: "Inizio Finestra Memoria (%)"
          description:
            en: "Memory window start - inputs before this % are ignored (debounce)"
            it: "Inizio finestra memoria - input prima di questa % sono ignorati (debounce)"
          widget: slider
          widget_config:
            step: 5
            tick_interval: 25
          advanced: true

      mem_window_end_pct:
        type: u8
        default: 100
        range: [0, 100]
        nvs_key: "mem_end"
        runtime_change: idle_only
        priority: 12
        gui:
          label_short:
            en: "Mem End"
            it: "Fine Mem"
          label_long:
            en: "Memory Window End (%)"
            it: "Fine Finestra Memoria (%)"
          description:
            en: "Memory window end - inputs after this % are ignored (too late)"
            it: "Fine finestra memoria - input dopo questa % sono ignorati (troppo tardi)"
          widget: slider
          widget_config:
            step: 5
            tick_interval: 25
          advanced: true

    subfamilies:
      presets:
        is_composite: true
        schema_version: 1
        count: 10
        active_index:
          type: u32
          default: 0
          range: [0, 9]
          nvs_key: "preset_idx"
          runtime_change: idle_only
          gui:
            label_short:
              en: "Preset"
              it: "Preset"
            label_long:
              en: "Active Preset"
              it: "Preset Attivo"
            description:
              en: "Currently selected preset (0-9)"
              it: "Preset attualmente selezionato (0-9)"
            widget: dropdown
            advanced: false
        preset_template:
          name:
            type: string
            max_length: 32
            default: ""
          speed_wpm:
            type: u32
            default: 25
            range: [5, 100]
          iambic_mode:
            type: enum
            enum_values: [MODE_A, MODE_B]
            default: MODE_B
          memory_mode:
            type: enum
            enum_values: [NONE, DOT_ONLY, DAH_ONLY, DOT_AND_DAH]
            default: DOT_AND_DAH
          squeeze_mode:
            type: enum
            enum_values: [LATCH_OFF, LATCH_ON]
            default: LATCH_ON
          mem_block_start_pct:
            type: f32
            default: 60.0
            range: [0.0, 100.0]
          mem_block_end_pct:
            type: f32
            default: 99.0
            range: [0.0, 100.0]

  audio:
    order: 2
    icon: "speaker"
    label:
      en: "Audio"
      it: "Audio"
    description:
      en: "Sidetone and audio output"
      it: "Tono laterale e uscita audio"
    aliases: [a, snd]

    parameters:
      sidetone_freq_hz:
        type: u16
        default: 600
        range: [400, 800]
        nvs_key: "st_freq"
        runtime_change: immediate
        priority: 3
        gui:
          label_short:
            en: "Tone"
            it: "Tono"
          label_long:
            en: "Sidetone Frequency (Hz)"
            it: "Frequenza Tono Laterale (Hz)"
          description:
            en: "Audio sidetone pitch in Hertz"
            it: "Tonalità del tono laterale audio in Hertz"
          widget: slider
          widget_config:
            step: 10
            tick_interval: 100
            common_values: [500, 600, 700, 800]
          advanced: false

      sidetone_volume:
        type: u8
        default: 70
        range: [1, 100]
        nvs_key: "st_vol"
        runtime_change: immediate
        priority: 4
        gui:
          label_short:
            en: "Volume"
            it: "Volume"
          label_long:
            en: "Sidetone Volume (%)"
            it: "Volume Tono Laterale (%)"
          description:
            en: "Audio output volume percentage"
            it: "Percentuale volume uscita audio"
          widget: slider
          widget_config:
            step: 5
            tick_interval: 10
          advanced: false

      fade_duration_ms:
        type: u8
        default: 5
        range: [1, 10]
        nvs_key: "fade_ms"
        runtime_change: reboot
        priority: 15
        gui:
          label_short:
            en: "Fade"
            it: "Dissolvenza"
          label_long:
            en: "Fade Duration (ms)"
            it: "Durata Dissolvenza (ms)"
          description:
            en: "Audio envelope fade time to eliminate clicks"
            it: "Tempo di dissolvenza dell'inviluppo audio per eliminare i click"
          widget: spinbox
          widget_config:
            step: 1
            suffix: " ms"
          advanced: true

  hardware:
    order: 3
    icon: "cpu"
    label:
      en: "Hardware"
      it: "Hardware"
    description:
      en: "GPIO and pin configuration"
      it: "Configurazione GPIO e pin"
    aliases: [hw, gpio]

    parameters:
      gpio_dit:
        type: u8
        default: 4
        range: [0, 45]
        nvs_key: "gpio_dit"
        runtime_change: reboot
        priority: 20
        gui:
          label_short:
            en: "DIT Pin"
            it: "Pin DIT"
          label_long:
            en: "DIT Paddle GPIO"
            it: "GPIO Paddle DIT"
          description:
            en: "GPIO pin number for DIT paddle input (internal pull-up)"
            it: "Numero pin GPIO per ingresso paddle DIT (pull-up interno)"
          widget: spinbox
          widget_config:
            step: 1
            prefix: "GPIO "
          advanced: true

      gpio_dah:
        type: u8
        default: 5
        range: [0, 45]
        nvs_key: "gpio_dah"
        runtime_change: reboot
        priority: 21
        gui:
          label_short:
            en: "DAH Pin"
            it: "Pin DAH"
          label_long:
            en: "DAH Paddle GPIO"
            it: "GPIO Paddle DAH"
          description:
            en: "GPIO pin number for DAH paddle input (internal pull-up)"
            it: "Numero pin GPIO per ingresso paddle DAH (pull-up interno)"
          widget: spinbox
          widget_config:
            step: 1
            prefix: "GPIO "
          advanced: true

      gpio_tx:
        type: u8
        default: 6
        range: [0, 45]
        nvs_key: "gpio_tx"
        runtime_change: reboot
        priority: 22
        gui:
          label_short:
            en: "TX Pin"
            it: "Pin TX"
          label_long:
            en: "TX Output GPIO"
            it: "GPIO Uscita TX"
          description:
            en: "GPIO pin number for transmitter keying output"
            it: "Numero pin GPIO per uscita chiave trasmettitore"
          widget: spinbox
          widget_config:
            step: 1
            prefix: "GPIO "
          advanced: true

      isr_blanking_us:
        type: u32
        default: 1500
        range: [0, 10000]
        nvs_key: "isr_blank"
        runtime_change: reboot
        priority: 23
        gui:
          label_short:
            en: "ISR Blank"
            it: "Blank ISR"
          label_long:
            en: "ISR Blanking Period (µs)"
            it: "Periodo Blanking ISR (µs)"
          description:
            en: "Paddle ISR blanking period in microseconds (0=disable ISR, use polling)"
            it: "Periodo blanking ISR paddle in microsecondi (0=disabilita ISR, usa polling)"
          widget: dropdown
          widget_config:
            options:
              - value: 0
                label:
                  en: "Disabled (polling only)"
                  it: "Disabilitato (solo polling)"
              - value: 1000
                label:
                  en: "1ms (fast repeat)"
                  it: "1ms (ripetizione veloce)"
              - value: 2000
                label:
                  en: "2ms (recommended)"
                  it: "2ms (raccomandato)"
              - value: 3000
                label:
                  en: "3ms (conservative)"
                  it: "3ms (conservativo)"
              - value: 5000
                label:
                  en: "5ms (very safe)"
                  it: "5ms (molto sicuro)"
          advanced: true

  timing:
    order: 4
    icon: "clock"
    label:
      en: "Timing"
      it: "Temporizzazione"
    description:
      en: "RT loop and PTT timing"
      it: "Loop RT e temporizzazione PTT"
    aliases: [t]

    parameters:
      ptt_tail_ms:
        type: u32
        default: 100
        range: [50, 500]
        nvs_key: "ptt_tail"
        runtime_change: idle_only
        priority: 6
        gui:
          label_short:
            en: "PTT Tail"
            it: "Coda PTT"
          label_long:
            en: "PTT Tail Timeout (ms)"
            it: "Timeout Coda PTT (ms)"
          description:
            en: "Time after last TX event before dropping PTT and returning to RX"
            it: "Tempo dopo l'ultimo evento TX prima di rilasciare PTT e tornare in RX"
          widget: slider
          widget_config:
            step: 10
            tick_interval: 50
          advanced: false

      tick_rate_hz:
        type: u32
        default: 10000
        range: [1000, 10000]
        nvs_key: "tick_hz"
        runtime_change: reboot
        priority: 25
        gui:
          label_short:
            en: "Tick Rate"
            it: "Frequenza Tick"
          label_long:
            en: "RT Loop Tick Rate (Hz)"
            it: "Frequenza Loop RT (Hz)"
          description:
            en: "Real-time loop polling frequency (higher = lower latency, more CPU)"
            it: "Frequenza polling del loop real-time (più alta = latenza minore, più CPU)"
          widget: dropdown
          widget_config:
            options:
              - value: 1000
                label:
                  en: "1 kHz (Low CPU)"
                  it: "1 kHz (CPU Basso)"
              - value: 2000
                label:
                  en: "2 kHz (Balanced)"
                  it: "2 kHz (Bilanciato)"
              - value: 5000
                label:
                  en: "5 kHz (High Performance)"
                  it: "5 kHz (Alta Prestazione)"
              - value: 10000
                label:
                  en: "10 kHz (Maximum Performance)"
                  it: "10 kHz (Prestazione Massima)"
          advanced: true

  system:
    order: 5
    icon: "settings"
    label:
      en: "System"
      it: "Sistema"
    description:
      en: "Debug and system settings"
      it: "Debug e impostazioni sistema"
    aliases: [sys]

    parameters:
      debug_logging:
        type: bool
        default: false
        nvs_key: "debug_log"
        runtime_change: immediate
        priority: 30
        gui:
          label_short:
            en: "Debug"
            it: "Debug"
          label_long:
            en: "Debug Logging"
            it: "Logging Debug"
          description:
            en: "Enable verbose debug logging (impacts performance)"
            it: "Abilita logging debug verboso (impatta le prestazioni)"
          widget: toggle
          widget_config:
            on_label:
              en: "Enabled"
              it: "Abilitato"
            off_label:
              en: "Disabled"
              it: "Disabilitato"
          advanced: true

      callsign:
        type: string
        max_length: 12
        default: "N0CALL"
        nvs_key: "callsign"
        runtime_change: immediate
        priority: 31
        gui:
          label_short:
            en: "Call"
            it: "Nominativo"
          label_long:
            en: "Callsign"
            it: "Nominativo"
          description:
            en: "Your amateur radio callsign"
            it: "Il tuo nominativo radioamatoriale"
          widget: text
          advanced: false

  leds:
    order: 6
    icon: "lightbulb"
    label:
      en: "LEDs"
      it: "LED"
    description:
      en: "RGB LED strip configuration"
      it: "Configurazione striscia LED RGB"
    aliases: [led, l]

    parameters:
      gpio_data:
        type: u8
        default: 38
        range: [0, 48]
        nvs_key: "led_gpio"
        runtime_change: reboot
        priority: 40
        gui:
          label_short:
            en: "Data Pin"
            it: "Pin Dati"
          label_long:
            en: "LED Data GPIO"
            it: "GPIO Dati LED"
          description:
            en: "GPIO pin for WS2812B data line"
            it: "Pin GPIO per linea dati WS2812B"
          widget: spinbox
          widget_config:
            step: 1
            prefix: "GPIO "
          advanced: true

      count:
        type: u8
        default: 7
        range: [0, 32]
        nvs_key: "led_count"
        runtime_change: reboot
        priority: 41
        gui:
          label_short:
            en: "Count"
            it: "Numero"
          label_long:
            en: "Number of LEDs"
            it: "Numero di LED"
          description:
            en: "Number of WS2812B LEDs in strip (0 to disable)"
            it: "Numero di LED WS2812B nella striscia (0 per disabilitare)"
          widget: spinbox
          widget_config:
            step: 1
          advanced: false

      brightness:
        type: u8
        default: 50
        range: [0, 100]
        nvs_key: "led_bright"
        runtime_change: immediate
        priority: 42
        gui:
          label_short:
            en: "Brightness"
            it: "Luminosità"
          label_long:
            en: "LED Brightness (%)"
            it: "Luminosità LED (%)"
          description:
            en: "Master brightness for all LEDs"
            it: "Luminosità principale per tutti i LED"
          widget: slider
          widget_config:
            step: 5
            tick_interval: 25
          advanced: false

      brightness_dim:
        type: u8
        default: 10
        range: [0, 50]
        nvs_key: "led_dim"
        runtime_change: immediate
        priority: 43
        gui:
          label_short:
            en: "Dim Level"
            it: "Livello Basso"
          label_long:
            en: "Idle Brightness (%)"
            it: "Luminosità in Attesa (%)"
          description:
            en: "Brightness level when idle (dim green)"
            it: "Livello luminosità in attesa (verde tenue)"
          widget: slider
          widget_config:
            step: 5
            tick_interval: 10
          advanced: true

  wifi:
    order: 7
    icon: "wifi"
    label:
      en: "WiFi"
      it: "WiFi"
    description:
      en: "Wireless network configuration"
      it: "Configurazione rete wireless"
    aliases: [w, net]

    parameters:
      enabled:
        type: bool
        default: false
        nvs_key: "wifi_en"
        runtime_change: reboot
        priority: 50
        gui:
          label_short:
            en: "Enable"
            it: "Abilita"
          label_long:
            en: "WiFi Enabled"
            it: "WiFi Abilitato"
          description:
            en: "Enable WiFi connectivity"
            it: "Abilita connettività WiFi"
          widget: toggle
          widget_config:
            on_label:
              en: "On"
              it: "Attivo"
            off_label:
              en: "Off"
              it: "Spento"
          advanced: false

      ssid:
        type: string
        max_length: 32
        default: ""
        nvs_key: "wifi_ssid"
        runtime_change: reboot
        priority: 51
        gui:
          label_short:
            en: "SSID"
            it: "SSID"
          label_long:
            en: "Network Name"
            it: "Nome Rete"
          description:
            en: "WiFi network name to connect to"
            it: "Nome della rete WiFi a cui connettersi"
          widget: text
          advanced: false

      password:
        type: string
        max_length: 64
        default: ""
        nvs_key: "wifi_pass"
        runtime_change: reboot
        sensitive: true
        priority: 52
        gui:
          label_short:
            en: "Password"
            it: "Password"
          label_long:
            en: "Network Password"
            it: "Password Rete"
          description:
            en: "WiFi network password"
            it: "Password della rete WiFi"
          widget: password
          advanced: false

      timeout_sec:
        type: u16
        default: 30
        range: [5, 120]
        nvs_key: "wifi_tout"
        runtime_change: reboot
        priority: 53
        gui:
          label_short:
            en: "Timeout"
            it: "Timeout"
          label_long:
            en: "Connection Timeout (s)"
            it: "Timeout Connessione (s)"
          description:
            en: "Seconds to wait for connection before AP fallback"
            it: "Secondi di attesa prima di passare alla modalità AP"
          widget: spinbox
          widget_config:
            step: 5
            suffix: " s"
          advanced: true

      use_static_ip:
        type: bool
        default: false
        nvs_key: "wifi_static"
        runtime_change: reboot
        priority: 54
        gui:
          label_short:
            en: "Static IP"
            it: "IP Statico"
          label_long:
            en: "Use Static IP"
            it: "Usa IP Statico"
          description:
            en: "Use static IP instead of DHCP"
            it: "Usa IP statico invece di DHCP"
          widget: toggle
          advanced: true

      ip_address:
        type: string
        max_length: 16
        default: "0.0.0.0"
        nvs_key: "wifi_ip"
        runtime_change: reboot
        priority: 55
        gui:
          label_short:
            en: "IP"
            it: "IP"
          label_long:
            en: "Static IP Address"
            it: "Indirizzo IP Statico"
          description:
            en: "Static IP address (e.g., 192.168.1.100)"
            it: "Indirizzo IP statico (es. 192.168.1.100)"
          widget: text
          advanced: true

      netmask:
        type: string
        max_length: 16
        default: "255.255.255.0"
        nvs_key: "wifi_mask"
        runtime_change: reboot
        priority: 56
        gui:
          label_short:
            en: "Netmask"
            it: "Netmask"
          label_long:
            en: "Subnet Mask"
            it: "Maschera di Sottorete"
          description:
            en: "Subnet mask (e.g., 255.255.255.0)"
            it: "Maschera di sottorete (es. 255.255.255.0)"
          widget: text
          advanced: true

      gateway:
        type: string
        max_length: 16
        default: "0.0.0.0"
        nvs_key: "wifi_gw"
        runtime_change: reboot
        priority: 57
        gui:
          label_short:
            en: "Gateway"
            it: "Gateway"
          label_long:
            en: "Default Gateway"
            it: "Gateway Predefinito"
          description:
            en: "Default gateway IP (e.g., 192.168.1.1)"
            it: "IP gateway predefinito (es. 192.168.1.1)"
          widget: text
          advanced: true

      dns:
        type: string
        max_length: 16
        default: "0.0.0.0"
        nvs_key: "wifi_dns"
        runtime_change: reboot
        priority: 58
        gui:
          label_short:
            en: "DNS"
            it: "DNS"
          label_long:
            en: "DNS Server"
            it: "Server DNS"
          description:
            en: "DNS server IP (e.g., 8.8.8.8)"
            it: "IP server DNS (es. 8.8.8.8)"
          widget: text
          advanced: true
